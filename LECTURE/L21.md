# Проблемы с протоколом IPv4
### Потребность в IPv6
---
Протокол IPv6 был разработан как преемник протокола IPv4. IPv6 имеет большее 128-битное адресное пространство, что достаточно для 340 ундециллионов адресов. Однако протокол IPv6 — это не только большее число адресов.  

Когда специалисты IETF начали разработку преемника IPv4, они использовали эту возможность для устранения ограничений протокола IPv4 и внесения дополнительных улучшений. Среди таких улучшений — протокол управляющих сообщений версии 6 (ICMPv6), который включает в себя разрешение адресов и автонастройку адресов, что отсутствовало в протоколе ICMP для IPv4 (ICMPv4).  

Сокращение адресного пространства протокола IPv4 — основной стимулирующий фактор для перехода к использованию IPv6. По мере того как Африка, Азия и другие регионы планеты все больше нуждаются в подключении к сети Интернет, остается все меньше IPv4-адресов, чтобы соответствовать таким темпам развития. Как показано на рисунке, у четырех из пяти региональных интернет-регистраторов (RIR) не осталось свободных IPv4-адресов.  

> Даты исчерпания IPv4 RIR

<img src="src\img\L21\1.png" width="700px">  

Теоретическое максимальное количество IPv4-адресов — 4,3 миллиарда. Частные адреса вместе с механизмом преобразования сетевых адресов (NAT) позволяли какое-то время замедлить процесс истощения адресного пространства IPv4. Однако механизм преобразования сетевых адресов (NAT) имеет определенные ограничения, которые ухудшают коммуникации в одноранговой сети.  

С увеличением числа мобильных устройств мобильные провайдеры лидировали по пути перехода на IPv6. Два крупнейших провайдера мобильной связи в США сообщают, что более 90% их трафика превышает IPv6.  

Большинство ведущих интернет-провайдеров и контент-провайдеров, таких как YouTube, Facebook и NetFlix, также сделали переход. Многие компании, такие как Microsoft, Facebook и LinkedIn, переходят на IPv6. В 2018 году широкополосный ISP Comcast сообщил о развертывании более 65%, а British Sky Broadcasting — более 86%.  

### Совместное использование протоколов IPv4 и IPv6
---
Точной даты для перехода на протокол IPv6 нет. Как IPv4, так и IPv6 будут сосуществовать в ближайшем будущем, и переход займет несколько лет. Специалисты IETF создали различные протоколы и инструменты, которые позволяют сетевым администраторам постепенно переводить свои сети на протокол IPv6. Методы перехода можно разделить на 3 категории.

#### Шаг 1. Двойной стек

Протоколы IPv4 и IPv6 можно одновременно использовать в одной сети посредством двойного стека. Устройства с двойным стеком одновременно работают с протокольными стеками IPv4 и IPv6. Известный как собственный IPv6, это означает, что сеть клиента имеет подключение IPv6 к своему Интернет-провайдеру и может получать доступ к контенту, найденному в Интернете, через IPv6.

#### Шаг 2. Туннелирование

Туннелирование — это способ передачи IPv6-пакета по IPv4-сети. IPv6-пакет инкапсулируется внутрь IPv4-пакета, как и другие типы данных.  

<img src="src\img\L21\2.png" width="700px">  

#### Шаг 3. Преобразование

Преобразование сетевых адресов 64 (NAT64) позволяет устройствам под управлением IPv6 обмениваться данными с устройствами под управлением IPv4 посредством способа преобразования, аналогичного NAT для IPv4. Пакет IPv6 преобразуется в пакет IPv4, а пакет IPv4 преобразуется в пакет IPv6.  

<img src="src\img\L21\3.png" width="700px"> 

# Представление IPv6-адресов

### Форматы адресов IPv6

Первым шагом к изучению IPv6 в сетях является понимание способа написания и форматирования IPv6 адреса. Адреса IPv6 намного больше, чем адреса IPv4, поэтому мы вряд ли закончим их.  

Длина IPv6-адресов составляет 128 бит, написанных в виде строки шестнадцатеричных значений. Каждые 4 бита представлены одной шестнадцатеричной цифрой, причем общее количество шестнадцатеричных значений равно 32, как показано на рисунке. IPv6-адреса нечувствительны к регистру, их можно записывать как строчными, так и прописными буквами.  

> 16-битные сегменты или гекстеты

<img src="src\img\L21\4.png" width="700px">  

#### Предпочтительный формат

Как показано на рисунке, формат записи адреса IPv6 ― x:x:x:x:x:x:x:x, где каждый x состоит из четырех шестнадцатеричных значений. Термин октет относится к восьми битам адреса IPv4. В IPv6-адресах сегмент из 16 бит или четырех шестнадцатеричных цифр неофициально называют гекстетом. Каждый х — это 1 гекстет, 16 бит или 4 шестнадцатеричные цифры.  

Предпочтительный формат означает, что IPv6-адрес записан с помощью 32 шестнадцатеричных цифр. Тем не менее, это не самый оптимальный способ представления IPv6-адреса. Существуют два правила, которые помогают уменьшить количество цифр, необходимых для представления адреса IPv6.  

Примеры записи IPv6-адресов в предпочтительном формате.  

```sh
2001 : 0db8 : 0000 : 1111 : 0000 : 0000 : 0000: 0200 
2001 : 0db8 : 0000 : 00a3 : abcd : 0000 : 0000: 1234 
2001 : 0db8 : 000a : 0001 : c012 : 9aff : fe9a: 19ac 
2001 : 0db8 : aaaa : 0001 : 0000 : 0000 : 0000: 0000 
fe80 : 0000 : 0000 : 0000 : 0123 : 4567 : 89ab: cdef 
fe80 : 0000 : 0000 : 0000 : 0000 : 0000 : 0000: 0001 
fe80 : 0000 : 0000 : 0000 : c012 : 9aff : fe9a: 19ac 
fe80 : 0000 : 0000 : 0000 : 0123 : 4567 : 89ab: cdef 
0000 : 0000 : 0000 : 0000 : 0000 : 0000 : 0000: 0001 
0000 : 0000 : 0000 : 0000 : 0000 : 0000 : 0000: 0000 
```